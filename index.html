



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Tutorial on how to expose Python bindings to your Maya C++ code">
      
      
      
        <meta name="author" content="Siew Yi Liang">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="./assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.2">
    
    
      
        <title>Writing a Maya Python C++ Extension</title>
      
    
    
      <link rel="stylesheet" href="./assets/stylesheets/application.7a4cdee3.css">
      
        <link rel="stylesheet" href="./assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="./assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="blue" data-md-color-accent="deep-orange">
    
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="." title="Writing a Maya Python C++ Extension" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Writing a Maya Python C++ Extension
              </span>
              <span class="md-header-nav__topic">
                About
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/sonictk/maya_python_c_extension" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      maya_python_c_extension
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Writing a Maya Python C++ Extension
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/sonictk/maya_python_c_extension" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      maya_python_c_extension
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        About
      </label>
    
    <a href="." title="About" class="md-nav__link md-nav__link--active">
      About
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about" title="About" class="md-nav__link">
    About
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-should-i-care" title="Why should I care?" class="md-nav__link">
    Why should I care?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-not-use-a-wrapper-for-this" title="Why not use a wrapper for this?" class="md-nav__link">
    Why not use a wrapper for this?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-is-this-going-to-work" title="How is this going to work?" class="md-nav__link">
    How is this going to work?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-you-will-need" title="What you will need" class="md-nav__link">
    What you will need
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-you-should-know" title="What you should know" class="md-nav__link">
    What you should know
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="getting_started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="writing_the_python_standalone_module/" title="Writing the Module" class="md-nav__link">
      Writing the Module
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="exposing_the_bindings_in_maya_plugin/" title="Exposing the Bindings Directly" class="md-nav__link">
      Exposing the Bindings Directly
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="credits/" title="Credits" class="md-nav__link">
      Credits
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about" title="About" class="md-nav__link">
    About
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-should-i-care" title="Why should I care?" class="md-nav__link">
    Why should I care?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-not-use-a-wrapper-for-this" title="Why not use a wrapper for this?" class="md-nav__link">
    Why not use a wrapper for this?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-is-this-going-to-work" title="How is this going to work?" class="md-nav__link">
    How is this going to work?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" title="Requirements" class="md-nav__link">
    Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-you-will-need" title="What you will need" class="md-nav__link">
    What you will need
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-you-should-know" title="What you should know" class="md-nav__link">
    What you should know
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="writing-a-maya-python-c-extension">Writing a Maya Python C++ Extension<a class="headerlink" href="#writing-a-maya-python-c-extension" title="Permanent link">&para;</a></h1>
<h2 id="about">About<a class="headerlink" href="#about" title="Permanent link">&para;</a></h2>
<p>This is a tutorial on how to expose bindings from your C++ code to Python by
means of writing a Python C++ extension. Unlike standard Python C/C++
extensions, however, I will elaborate on specific steps to take when writing
bindings that take advantage of the Maya libraries, along with how the extension
will work within the Maya Python interpreter.</p>
<p>All the source code for this example node is available
<a href="https://bitbucket.org/sonictk/maya_python_c_extension">here</a>.</p>
<h2 id="why-should-i-care">Why should I care?<a class="headerlink" href="#why-should-i-care" title="Permanent link">&para;</a></h2>
<p>To be honest, I actually have started to become less reliant on Python as I
continue to write more and more code, even in Maya, now that I can <a href="https://bitbucket.org/sonictk/maya_hot_reload_example">hotload
my C++ code</a>. However,
there are some very good reasons why we might still want to write Python
bindings for our C++ code:</p>
<ul>
<li>
<p>Legacy code: the reality is that there is a lot of code out there that is
  already written in Python. Depending on the project, it might not be worth the
  effort to re-write the entire project in C++ just for the sake of using a couple
  of utility functions. However, re-writing C++ functions from scratch back to
  Python is also a pain, not to mention that we'd take a <em>much</em> larger
  performance hit than going the route of a Python C++ extension due to the
  larger amount of memory that would need to be marshaled between the two
  layers, along with the levels of indirection.</p>
</li>
<li>
<p>Ease of utilities: while hot-reloadable code is nice, the fact remains that
  sometimes, it is easier to be able to call specific utility functions from
  both Python and C++ for the sake of inspecting scenes. Writing template
  <code>MPxCommand</code> boilerplate gets incredibly annoying after a while, along with
  making it more difficult to actually integrate with a Python codebase.
  (i.e. returning Python <code>dict</code> or other data types is not possible directly
  from a traditional Maya command.)</p>
</li>
<li>
<p>Extending existing bindings: the reason I even bothered to write this tutorial
  in the first place is because there's been a lot of grumbling from both at
  work and outside of work from fellow TDs alike about the state of the Python
  OpenMaya bindings. My primary goal here is to show that it's actually fairly
  trivial to write your own bindings if needed.</p>
</li>
</ul>
<h2 id="why-not-use-a-wrapper-for-this">Why not use a wrapper for this?<a class="headerlink" href="#why-not-use-a-wrapper-for-this" title="Permanent link">&para;</a></h2>
<p>When it comes to generating Python bindings for a C/C++ API, there are a
plethora of tools out there. 
<a href="https://www.boost.org/doc/libs/1_67_0/libs/python/doc/html/index.html">Boost.Python</a>,
<a href="http://www.swig.org/">SWIG</a> and more recently, <a href="https://github.com/pybind/pybind11">pybind11</a>
are all examples of wrappers that can help to automate the process of having to
write the bindings by hand. As a matter of fact, this is how the OM1 bindings
were generated in the first place (using SWIG). Ideally, this allows the
programmer to focus on the implementation on the C/C++ side without worrying 
about the details involved with translating the code to Python.</p>
<p>At least, that's the theory. As ever, in practice, everything comes down to a
single principle: <em>your job is to work with memory, not write code.</em> If you
don't know what you're doing with the memory, you're guaranteed to be setting
yourself (or others) up for failure. In this case, it means:</p>
<ul>
<li>
<p><strong>Harder-to-debug abstraction layers whenever the bindings don't work as you
  expect</strong>. Writing Python bindings is already a level of abstraction that we're
  accepting here as a necessary cost; the last thing needed is to add <em>even
  more</em> cruft on top of that. </p>
</li>
<li>
<p><strong>Absolute control over the memory and how it's managed</strong>. Rather than code all
  sorts of machinery in order to perform simple tasks like cleaning up
  allocations at module destruction time, or wasting time with <code>unique_ptr</code>
  and <code>shared_ptr</code> shennanigans, I find everything is much simpler when just
  writing the bindings by hand.</p>
</li>
<li>
<p>pybind11, at least, does not account for the GIL by default unless you make
  specific wrapper calls (e.g. <code>call_go</code> using the <code>call_guard</code>policy). 
  Personally, after giving it a go, I see zero benefit to using it over writing 
  the bindings manually. Every framework has its own shennigans to work with
  when using them, and I haven't really seen one that I considered worth the
  cost of working with.</p>
</li>
<li>
<p>To that point, <strong>not every project can afford to use a C++11-compliant
  compiler</strong>. (Remember, as recently as Maya 2016, the official compiler version
  was not even C++11 capable)!</p>
</li>
<li>
<p>The <strong>historical results speak for themselves</strong>: The Maya OM1 bindings, which were
  generated via SWIG, are far slower than the hand-written bindings in OM2
  (which are also incidentally far easier to use and don't require the use of
  other wrapper classes such as <code>MScriptUtil</code> to handle converting between
  pointer and POD types). If you're going to eat of the cost of making bindings
  between a scripting language and a compiled one, you might as well try to
  minimize the overhead in the process. At scale, automatically-generated
  bindings just don't work.</p>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>I encourage you to try the alternatives stated and decide for yourself which
approach is easier at scale and works for your particular use case. Here,
however, I will focus only on hand-writing the bindings and not on any
unnecessary wrappers since I am focusing on simple examples.</p>
</div>
<h2 id="how-is-this-going-to-work">How is this going to work?<a class="headerlink" href="#how-is-this-going-to-work" title="Permanent link">&para;</a></h2>
<p>We're going to eschew the official Python
<a href="https://docs.python.org/2/extending/building.html#building"><code>distutils</code></a> for
this, and compile everything on our own. Before you start shouting "That's
un-Pythonic!" from the top of your horse, bear with it: there are fairly good
reasons for this, which I'll explain later. </p>
<p>We'll be making two types of Maya Python C++ Extensions: the first will be a
traditional Python C extension that makes use of the Maya libraries; the second,
however, will be an actual Maya plugin that exposes the Python bindings
automatically once it's loaded in Maya. The nice thing about the second approach
is that if you want to expose your bindings from a Maya plugin, you can do so
just by loading the plugin itself without having add the <code>.pyd/.so</code> file onto
the <code>PYTHONPATH</code>. However, this approach also comes with its own cons, which
I will discuss during the implementation phase.</p>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<p>This tutorial will come from a <em>Windows-first approach</em>. Whenever platform-specific
information is appropriate, it will appear in the following form:</p>
<div class="admonition tip">
<p class="admonition-title">Crossing the platforms</p>
<p>Platform-specific information goes here.</p>
</div>
<h3 id="what-you-will-need">What you will need<a class="headerlink" href="#what-you-will-need" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Maya 2018 or higher</strong>. </p>
</li>
<li>
<p><strong>Python 2.7.xx (Python 3.x series is <em>not</em> a substitute!)</strong>.</p>
</li>
<li>
<p>A <strong>C/C++ development environment</strong> set up and ready to go. (If you want to see
  what my Emacs setup looks like, it's
  available <a href="https://github.com/sonictk/lightweight-emacs">here</a>.)</p>
</li>
<li>
<p>On Windows, you will need the corresponding <strong>Visual Studio</strong> version that
  your version of Maya was compiled with. For Maya 2018, this is <strong>Visual Studio
  2015</strong>. </p>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Crossing the platforms</p>
<p>On Linux, you will need GCC 4.8.2 against the Linux kernel in CentOS 6.5.
On OSX, you will need Xcode 7.3.1 against the 10.11 SDK.</p>
</div>
<ul>
<li>Spare time and an open mind.</li>
</ul>
<h3 id="what-you-should-know">What you should know<a class="headerlink" href="#what-you-should-know" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Basic knowledge of C/C++</strong>. I will focus on including only the code that is
  important; I expect you to be able to understand how to fill in the rest as
  needed. At the very least, you should be able to compile a Maya plug-in and
  run it using whatever toolchain you're familar with.</p>
</li>
<li>
<p><strong>Basic knowledge of how Maya plugins work and how to write/build them</strong>. 
  The repository has sample build scripts designed to work on Windows and Linux.</p>
</li>
<li>
<p><strong>Basic knowledge of Python</strong>. Obviously, you'll need to know basic Python
  syntax and the various data types available, since we're going to be
  marshaling them between them and C++.</p>
</li>
</ul>
<p>In the next section, we'll go over a high-level overview of how a Python C/C++
extension works.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="getting_started/" title="Getting Started" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Getting Started
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/sonictk" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/ylsiew" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/sonictk" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="./assets/javascripts/application.6cdc17f0.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"."}})</script>
      
    
    
      
    
  </body>
</html>